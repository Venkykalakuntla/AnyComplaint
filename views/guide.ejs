<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Guided Filing</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <link rel="stylesheet" href="/styles/style.css" /> 
    <link rel="stylesheet" href="/styles/guide.css" /> 
</head>
<body>
    
    <%- include('partials/navbar') %>
        
    <div id="server-data" data-originalproblem="<%= JSON.stringify(originalProblem) %>" style="display: none"></div>

    <div class="guide-layout">
        <main class="guide-content">
            <hgroup>
                <h1>Filing Guide ðŸ“„</h1>
                <h2>
                    Click anywhere on a step's card to ask the AI Assistant a question
                    about it.
                </h2>
            </hgroup>

            <div class="static-card">
                <h3>Required Documents Checklist ðŸ“‹</h3>
                <pre><%= documentsContent %></pre>
            </div>

            <% if (guideContent && guideContent.length) { %> 
                <% guideContent.forEach(step => { %>
                <div class="step-card" data-step-number="<%= step.step_number %>" data-context="<%= step.instruction %>">
                    <div class="step-content">
                        <h3>Step <%= step.step_number %></h3>
                        <p class="step-instruction"><%= step.instruction %></p>
                    </div>
                </div>
                <% }); %> 
            <% } else { %>
                <div class="static-card">
                    <p>No guide steps were generated for this portal.</p>
                </div>
            <% } %>
        </main>

        <aside class="chat-sidebar">
            <h3>Not Sure? Ask meðŸ¤–</h3>
            <div id="chatHistory" class="chat-history">
                <div class="chat-bubble ai">
                    Welcome! Click on any step card in the guide to begin asking
                    questions.
                </div>
            </div>
            <form id="chatForm">
                <label for="currentStepDisplay">Question about:</label>
                <div id="currentStepDisplay">No step selected</div>
                <label for="userQuestion">Your Question:</label>
                <textarea
                    id="userQuestion"
                    placeholder="Select a step to enable..."
                    rows="3"
                    required
                    disabled
                ></textarea>
                <button type="submit" disabled>Send</button>
            </form>
        </aside>
    </div>

    <script src="/js/guide-logic.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>