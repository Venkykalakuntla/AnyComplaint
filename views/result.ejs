<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Your Complaint Draft</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <link rel="stylesheet" href="/styles/style.css" /> 
    <link rel="stylesheet" href="/styles/result.css" /> 
</head>
<body>
    <%- include('partials/navbar') %>

    <div class="app-container">
        <aside class="sidebar">
            <h1>Refine & Control</h1>
            <h2>Not perfect? Tell the AI what to change.</h2>

            <form id="refineForm" action="/refine" method="POST">
                <input type="hidden" name="originalProblem" value="<%= problem %>" /> 
                <input type="hidden" name="complaintId" value="<%= complaintId %>" />
                <input type="hidden" name="complaintDraft" value="<%= complaintText %>" />
                <input type="hidden" name="category" value="<%= category %>" />
                <input type="hidden" name="portal" value="<%= portal %>" />
                <input type="hidden" name="portal_id" value="<%= portal_id %>" />
                <input type="hidden" name="documents" value="<%= documents %>" />
                <input type="hidden" name="guide" value='<%= JSON.stringify(guide) %>' />

                <label for="refineInstruction">Refinement Instruction:</label>
                <textarea
                    id="refineInstruction"
                    name="refineInstruction"
                    rows="5"
                    placeholder="e.g., Make the tone more urgent. Mention the exact date of the incident."
                    required
                ></textarea>

                <button type="submit" id="refineBtn" style="margin-top: 1rem">
                    âœ¨ Refine Draft
                </button>
            </form>
        </aside>

        <main class="main-content">
            <div class="details-card">
                <p><strong>Category:</strong> <%= category %></p>
                <p>
                    <strong>Recommended Portal:</strong>
                    <a href="<%= portal %>" target="_blank" rel="noopener noreferrer"><%= portal %></a>
                </p>
            </div>

            <div class="document-viewer">
                <div class="document-header">
                    <h3>Generated Complaint</h3>
                    <div class="document-actions">
                        <button onclick="copyDraft()">ðŸ“‹ Copy</button>
                        <form
                            action="/guide"
                            method="POST"
                            target="_blank"
                            style="display: inline"
                        >
                            <input type="hidden" name="documents" value="<%= documents %>" />
                            <input type="hidden" name="portal_id" value="<%= portal_id %>" />
                            <input type="hidden" name="guide" value='<%= JSON.stringify(guide) %>' />
                            <input type="hidden" name="originalProblem" value="<%= problem %>" />
                            <button type="submit">View Interactive Guide</button>
                        </form>
                    </div>
                </div>
                <div id="complaintTextArea" class="document-content">
                    <pre><%= complaintText %></pre>
                </div>
            </div>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/result-logic.js" defer></script>
</body>
</html>